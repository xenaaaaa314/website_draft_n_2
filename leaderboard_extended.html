<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Leaderboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Space Grotesk', sans-serif;
    }
  </style>

  <style>
  /* Custom Scrollbar Styles */
    /* For Webkit browsers (Chrome, Safari, Edge) */
    ::-webkit-scrollbar {
      width: 12px;
      height: 12px;
    }

    ::-webkit-scrollbar-track {
      background: #1a0000;
      border-radius: 6px;
    }

    ::-webkit-scrollbar-thumb {
      background: #d1181e;
      border-radius: 6px;
      border: 2px solid #1a0000;
      transition: background 0.3s ease;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #ff4444;
      border-color: #000000;
    }

    ::-webkit-scrollbar-thumb:active {
      background: #b91016;
    }

    /* For Firefox */
    * {
      scrollbar-width: thin;
      scrollbar-color: #d1181e #1a0000;
    }

    /* Optional: Hide scrollbar during loading phases */
    body.loading {
      overflow: hidden;
    }

    /* Optional: Custom selection colors to match theme */
    ::selection {
      background: #d1181e;
      color: white;
    }

    ::-moz-selection {
      background: #d1181e;
      color: white;
    }

    #nav-container {
      transition: all 0.4s ease;
      will-change: transform, opacity;
    }

    #nav-toggle {
      transition: all 0.3s ease;
    }

    html {
  scroll-behavior: smooth;
}

  </style>

  <link rel="icon" type="image/png" href="img/logo.png" sizes="32x32">
<link rel="apple-touch-icon" href="img/logo.png">
</head>
<body class="bg-white text-black font-sans">

<!-- Back to Home Button - Left side version -->
<a href="index.html" 
   class="fixed bottom-8 left-8 w-14 h-14 bg-black rounded-full shadow-lg flex items-center justify-center hover:bg-gray-800 transition-all hover:scale-110 z-50">
  <svg class="w-6 h-6 text-white" 
       fill="none" 
       stroke="currentColor" 
       stroke-width="3" 
       viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
  </svg>
</a>



    <!-- TRANSITION LOADER -->
<div id="loader" class="fixed inset-0 z-50 bg-black flex flex-col items-center justify-center transition-opacity duration-[2000ms] hidden">
    <h1 class="text-white text-4xl font-bold tracking-widest mb-4">ORAMA</h1>
    <div class="flex gap-2">
      <span class="w-2 h-2 bg-white rounded-full animate-bounce [animation-delay:0ms]"></span>
      <span class="w-2 h-2 bg-white rounded-full animate-bounce [animation-delay:200ms]"></span>
      <span class="w-2 h-2 bg-white rounded-full animate-bounce [animation-delay:400ms]"></span>
    </div>
  </div>

 <main class="max-w-6xl mx-auto py-20 px-6">
    <div class="text-center mb-10">
      <p id="current-date" class="text-sm text-gray-500"></p>
      <h1 class="text-4xl font-bold mt-1 mb-2">LEADERBOARD</h1>
    </div>

   
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const dateElement = document.getElementById("current-date");

    const options = { month: 'long', day: 'numeric' };
    const today = new Date();
    const formattedDate = today.toLocaleDateString('en-US', options);

    dateElement.textContent = formattedDate;
  });
</script>

<div class="mt-16 text-center max-w-3xl mx-auto relative pb-12">

  <!-- Paragraph -->
  <p class="text-sm text-gray-700 leading-relaxed mb-8">
This table extends the previous work by providing a detailed breakdown of scores across 11 sub-categories. It highlights both areas of highest proficiency and those requiring additional focus. Notably, Response to Explosive Ordinances has the lowest average score (~5.05).

To enable a higher-level view, the sub-categories are grouped into three broader domains:
	1.	Cognitive Proficiency — Awareness, target discrimination, and adaptability. These reduce surprise and poor decision-making, strongly influencing survival.
	2.	Tactical Proficiency — Skills such as room entry, corner slicing, and use of cover, which directly affect exposure and engagement outcomes.
	3.	Equipment Proficiency — Handling and reliability of equipment. While important, their impact can sometimes be mitigated by strong cognitive and tactical performance.

An experimental weighting system is introduced, with cognitive proficiency weighted more heavily than equipment proficiency, reflecting its outsized influence on overall performance. The broader aim of this approach is to develop a rigorous mathematical framework that captures how different skills interact and correlate.

Further updates and comprehensive analysis will be provided in an extended paper.
</div>


<!-- GOOGLE TABLE SECTION -->
<section class="bg-white py-6 px-6 border-gray-200 relative opacity-0 translate-y-8 transition-all duration-1000 ease-in-out scroll-fade">
<!-- Loading Spinner -->
<div id="loading" class="absolute inset-0 flex items-center justify-center bg-white bg-opacity-80 z-10">
<div class="animate-spin rounded-full h-10 w-10 border-t-4 border-[#d1181e] border-opacity-50"></div>
</div>

<!-- PapaParse (robust CSV parser) -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<div class="flex flex-wrap justify-center gap-4 items-center mb-6">
  <!-- Tab (gid) selector -->
  <select id="tabSelect"
          class="border px-4 py-2 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-[#d1181e]">
  </select>

  <!-- Search -->
  <input id="searchInput" type="text" placeholder="Search..."
         class="border px-4 py-2 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-[#d1181e] w-full max-w-md text-center" />

  <!-- Export -->
  <button id="exportBtn"
          class="px-5 py-2 bg-[#d1181e] text-white rounded-lg hover:bg-[#a30f15] transition shadow-md">
    Export as CSV
  </button>
</div>

  
<!-- Table wrapper with relative positioning -->
<div id="tableWrapper"
     class="relative overflow-x-auto rounded-xl border border-[#d1181e] shadow-xl max-w-full">
  <table id="dataTable" class="min-w-max border-collapse text-sm"></table>

  <!-- Scroll Hint -->
  <div id="scrollHint"
       class="hidden md:flex items-center justify-center absolute top-2 right-4
              text-gray-500 text-xs bg-white px-3 py-1 rounded-full shadow-md
              transition-opacity duration-500">
    ← Scroll →
  </div>
</div>



	


<!-- Pagination -->
<div id="pagination" class="flex justify-center items-center space-x-2 pt-6 text-sm"></div>
</div>
</section>

<script>
/* ------------ CONFIG ------------- */
// Your spreadsheet ID (from /d/<THIS>/edit in the normal URL)
const SHEET_ID = "1u-HwRbprndkBv0DiJUJ7oDBldWammVThTx5OzblztdM";

/* List your tabs here: label + gid (from #gid=... in the URL).
   Add as many as you need. The first one loads by default. */
const SHEETS = [
	{ label: "Detailed Scores", gid: "95731814" },
  { label: "Cognitive Proficiency", gid: "0" },
  { label: "Tactical Proficiency",     gid: "822895727" },
  { label: "Equipment proficiency",     gid: "1750630092" },
];

/* -------------------------------- */

const tableEl     = document.getElementById("dataTable");
const searchInput = document.getElementById("searchInput");
const tabSelect   = document.getElementById("tabSelect");
const exportBtn   = document.getElementById("exportBtn");
const loading     = document.getElementById("loading");

let fullData = [];   // 2D array: [ [col1,col2,...], [row1...], ... ]
let currentGID = SHEETS[0].gid;

function csvUrl(sheetId, gid) {
  return `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv&gid=${gid}`;
}

function populateTabSelect() {
  tabSelect.innerHTML = "";
  SHEETS.forEach(({label, gid}) => {
    const opt = document.createElement("option");
    opt.value = gid;
    opt.textContent = label;
    tabSelect.appendChild(opt);
  });
  tabSelect.value = currentGID;
}

async function loadSheet(gid) {
  loading.style.display = "flex";
  currentGID = gid;
  const url = csvUrl(SHEET_ID, gid);

  // Fetch CSV and parse with Papa
  const res = await fetch(url, { cache: "no-store" });
  const csvText = await res.text();
  const parsed = Papa.parse(csvText, { skipEmptyLines: true });
  fullData = parsed.data; // array of arrays

  renderTable();
  loading.style.display = "none";
}

function renderTable() {
  tableEl.innerHTML = "";
  if (!fullData.length) return;

  // Filter by search
  const query = (searchInput.value || "").toLowerCase().trim();
  const rows = fullData.slice(1).filter(r =>
    !query ||
    r.some(c => String(c).toLowerCase().includes(query))
  );

  // Header
  const thead = document.createElement("thead");
  const trh = document.createElement("tr");
  fullData[0].forEach((h, i) => {
    const th = document.createElement("th");
    th.textContent = h;
 	th.className =
  "bg-black text-white text-xs sm:text-sm md:text-base " +
  "px-2 py-2 sm:px-4 sm:py-3 text-left uppercase cursor-pointer " +
  "whitespace-normal break-words sticky top-0 z-10";
    th.addEventListener("click", () => sortBy(i));
    trh.appendChild(th);
  });
  thead.appendChild(trh);
  tableEl.appendChild(thead);

  // Body (ALL rows visible; no pagination)
  const tbody = document.createElement("tbody");
  rows.forEach(row => {
    const tr = document.createElement("tr");
    tr.className = "transition hover:bg-[#d1181e]/10";
    row.forEach(cell => {
      const td = document.createElement("td");
      td.textContent = cell;
      td.className =
  "px-2 py-2 sm:px-4 sm:py-3 border-t border-gray-200 " +
  "whitespace-normal break-words align-top";
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
  tableEl.appendChild(tbody);
	  checkScrollHint();
}

// Intelligent sort: numeric if both cells look like numbers, else lexicographic
function sortBy(index) {
  const header = fullData[0];
  const rows = fullData.slice(1);

  const ascending = !tableEl.dataset.sortOrder || tableEl.dataset.sortOrder === "desc";
  tableEl.dataset.sortOrder = ascending ? "asc" : "desc";

  const asNumber = v => {
    const n = Number(String(v).replace(/,/g, ""));
    return Number.isFinite(n) ? n : null;
  };

  rows.sort((a, b) => {
    const aNum = asNumber(a[index]);
    const bNum = asNumber(b[index]);

    if (aNum !== null && bNum !== null) {
      return ascending ? aNum - bNum : bNum - aNum;
    }
    const aTxt = String(a[index]).toLowerCase();
    const bTxt = String(b[index]).toLowerCase();
    return ascending ? aTxt.localeCompare(bTxt) : bTxt.localeCompare(aTxt);
  });

  fullData = [header, ...rows];
  renderTable();
}

/* Export ONLY currently filtered rows (including header) */
exportBtn.addEventListener("click", () => {
  const query = (searchInput.value || "").toLowerCase().trim();
  const visible = fullData.filter((row, i) =>
    i === 0 || row.some(c => String(c).toLowerCase().includes(query))
  );
  const csv = Papa.unparse(visible);
  const blob = new Blob([csv], { type: "text/csv;charset=utf-8" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "orama_data.csv";
  a.click();
});

searchInput.addEventListener("input", renderTable);
tabSelect.addEventListener("change", (e) => loadSheet(e.target.value));

/* Init */
populateTabSelect();
loadSheet(currentGID);
</script>



  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const loader = document.getElementById('loader');
      if (localStorage.getItem('oramaFromIndex')) {
        loader.classList.remove('hidden');
        setTimeout(() => {
          loader.classList.add('opacity-0');
          setTimeout(() => {
            loader.style.display = 'none';
            localStorage.removeItem('oramaFromIndex');
          }, 1000);
        }, 100); // optional delay
      }
    });
  </script>


<script>
  const fadeElements = document.querySelectorAll('.scroll-fade');

  const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.remove('opacity-0', 'translate-y-8');
      }
    });
  }, {
    threshold: 0.1
  });

  fadeElements.forEach(el => observer.observe(el));
</script>

<script>
// ---- Scroll hint logic ----
const wrapper    = document.getElementById("tableWrapper");
const scrollHint = document.getElementById("scrollHint");

function checkScrollHint() {
  if (!wrapper || !scrollHint) return;
  // show only if content is wider than the viewport
  if (wrapper.scrollWidth > wrapper.clientWidth) {
    scrollHint.classList.remove("hidden");
  } else {
    scrollHint.classList.add("hidden");
  }
}

// Fade hint out once user scrolls a bit
wrapper?.addEventListener("scroll", () => {
  if (wrapper.scrollLeft > 30) {
    scrollHint.classList.add("opacity-0");
  } else {
    scrollHint.classList.remove("opacity-0");
  }
});

// Also run on resize
window.addEventListener("resize", checkScrollHint);
</script>
</body>
</html>
